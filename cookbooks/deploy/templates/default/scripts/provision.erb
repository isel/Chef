require 'rake'
require '<%= node['binaries_directory'] %>/CI/BuildScripts/Deployment/provision'

exe = '/Provision/bin/UltimateSoftware.Provisioning.Runner.exe'

if Dir.exist?('/Provision') && '<%= @force_provision %>' != 'true'
  puts 'Deployment has already been provisioned'
  exit
end

puts 'Provisioning deployment'

provision = Deployment::Provision.new(
  '<%= node['binaries_directory'] %>', '/Provision', '<%= node['pims_directory'] %>', '/PIM_Publishing')

provision.run('<%= @tenant %>', '<%= @app_server %>', '<%= @db_server %>', '<%= @db_port %>', exe)