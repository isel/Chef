require '<%= node['binaries_directory'] %>/CI/BuildScripts/Cloud/deployment'
require '<%= node['binaries_directory'] %>/CI/BuildScripts/Helpers/process'

servers = Cloud::Deployment.new.discover_servers('<%= @deployment_name %>')

Helpers::Process.new(15).run('waiting for a server to be tagged', <%= @timeout %>) do
  servers.select { |name, server| (server.tags['<%= @tag_key %>'] == '<%= @tag_value %>') }.count > 0
end




