require 'rake'
require 'rspec/core/rake_task'
require 'json'

settings = JSON.parse(File.read('<%= node['deployment_settings_json'] %>'))

ENV['domain.name'] = ''

ENV['app_server'] = '<%= @app_server %>'
ENV['db_server'] = '<%= @db_server %>'
ENV['db_port'] = settings['database_port']
ENV['engine_server'] = '<%= @engine_server %>'
ENV['messaging_server'] = '<%= @messaging_server %>'
ENV['messaging_server_port'] = settings['messaging_port']
ENV['tenant'] = '<%= @tenant %>'

smoke_tests_dir = '<%= node[:binaries_directory] %>/CI/spec/Smoke'

RSpec::Core::RakeTask.new(:spec) do |t|
  t.pattern = ["#{smoke_tests_dir}/deploy_global_spec.rb", "#{smoke_tests_dir}/deploy_global_<%= @tenant %>_spec.rb"]
end

task :default => [:spec]