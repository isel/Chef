require 'rake'
require 'rspec/core/rake_task'
require 'json'

settings = JSON.parse(File.read('<%= node['ruby_scripts_dir'] %>/deployment_settings.txt'))

ENV['mule_port'] = settings['mule_port']
ENV['activemq_port'] = settings['activemq_port']
ENV['activemq_console_port'] = '<%= @activemq_console_port %>'

ENV['db_server'] = '<%= @db_server %>'
ENV['db_port'] = settings['database_port']

ENV['app_server'] = '<%= @app_server %>'

ENV['search_port'] = settings['search_port']
ENV['search_server'] = '<%= @search_server %>'

ENV['engine_port'] = settings['engine_port']
ENV['engine_server'] = '<%= @engine_server %>'

ENV['cache_server'] = '<%= @cache_server %>'

ENV['messaging_server'] = '<%= @messaging_server %>'
ENV['messaging_server_port'] = settings['messaging_port']

ENV['web_server'] = '<%= @web_server %>'

RSpec::Core::RakeTask.new(:spec) do |t|
  t.pattern = '<%= node['binaries_directory'] %>/CI/spec/Smoke/deploy_<%= @server_type %>_spec.rb'
end

task :default => [:spec]